language: php
php:
    - 5.6
    - 7.2
    - 7.3
    - 7.4
arch:
    - amd64
    - ppc64le
    - s390x
    - arm64
jobs:
    exclude:
        - php: 5.6
          arch: s390x
        - php: 5.6
          arch: arm64
    allow_failures:
        - arch: ppc64le
        - arch: s390x
        - arch: arm64
os:
    - linux
    # - osx # Services are not supported on osx
    # - windows # The language 'php' is currently unsupported on the Windows Build Environment. 
services:
    - mysql
addons:
  apt:
    sources:
      - mysql-5.7-trusty
    packages:
      - dpkg
      - mysql-server
      - mysql-client
install: 
    - sudo apt-get -y -q -m --no-install-suggests --no-install-recommends --allow-unauthenticated $(travis_apt_get_options) install dpkg mysql-server mysql-client 
before_install:
    #update packages in quite mode.
    - sudo apt-get -q update
    #install postfix mail server
    - sudo apt-get -y install postfix
    #create a test database
    - mysql -e 'create database if not exists testing_db;'
    - sudo mysql -e "use mysql; update user set authentication_string=PASSWORD('123456') where User='root'; update user set plugin='mysql_native_password';FLUSH PRIVILEGES;"
    - sudo mysql_upgrade -u root -p123456
    - sudo service mysql restart
before_script:
    - composer self-update
    - composer install --prefer-source --no-interaction
script:
    - phpunit --configuration phpunit.xml
after_success:
    - mysql -e 'drop database testing_db;'
    - bash <(curl -s https://codecov.io/bash)
    - addons:
        sonarcloud:
          organization: "usernane"
          token:
              secure: WiRRGSfM+g/Gld7JF4b2Ow+xJjCTvG9qUP317x3FVJ0N4HUlZxqmJQv6G7TzQEAH7hz1w6pVe5wPClMKJ7abNA0nB91Bf34kRxA17v/Mhuyjx+YJs+ptA7Jhp28I57edDU4JErFi4OlJraQYgvq/ZMtlZ/xPNpKO3UB5/mCC0FQOgrkQA0E7HN7PY2mSKHO6k/jt/WKe49Ta4OzyM9vdWk8CscxeJmPhLs4reaPjFjPGYKo7+muKCGsh7pCYpvsQvG0eH2W7uB4K6ck5t0Azquai6GjK8xyT+Ogd9ehGijJ/d6YfKzp3iHoaDcEn3CWLluiGD7FlcFGNt/uQwvn/Imapq73usqmtWbA4xnZ6IEDNHrC/odOZPmpq+2KxiS8/fCNLOgH2O+kdnwQuGSAywxQNyKMnU9ixnGjyIQYCHYfKbGSK+O65WBpJ9NtL8CfFHTAK84DemGNo9DsowwMpfiWYGqu4mZGaImR/qmAT+c9qwu1Vqgqh2RMBQOIckVm7b4ooULrHl1nk8chCe50TRI7H0pgnM3xGwet8BQe7de2Z/gUD/xiHelvbocUEbE3LKxtVLBruq8rbFWl4Psj0qyRqpQ4afo9nBxGVBWmxsDN5P0UQCUpTP1STUGI3cps7CWNPZSDlAkiQdnLQNptgi5E+3cpW2spkjV2ojTxU7HQ=

      script:
        # the following command line builds the project, runs the tests with coverage and then execute the SonarCloud analysis
        - sonar-scanner
