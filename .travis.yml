language: php
php:
    - 5.6
    - 7.2
    - 7.3
    - 7.4
arch:
    - amd64
    - ppc64le
    - s390x
    - arm64
jobs:
    exclude:
        - php: 5.6
          arch: s390x
        - php: 5.6
          arch: arm64
    allow_failures:
        - arch: ppc64le
        - arch: s390x
        - arch: arm64
os:
    - linux
    # - osx # Services are not supported on osx
    # - windows # The language 'php' is currently unsupported on the Windows Build Environment. 
services:
    - mysql
addons:
    apt:
        sources:
            - mysql-5.7-trusty
        packages:
            - dpkg
            - mysql-server
            - mysql-client
    sonarcloud:
        organization: "webfiori"
        token:
            secure: Ew8NfjVlyTt5qwpIGS4682aCZiQqiFW3DYvVUPOqwCR0XlYDaL+igwiEUwFPYd13BnvcM4b3GbL694pxJS0fukHwNAwxFYCMZC39nLIjHqvo5dMyIK6eoDj0E+l+gfnuIRwddL+2dZywr2YNi9t5kWkShpa8oeqTNvtYgjPOGIdsKHD1guOIITiWTdXhIpkgoKAwZqZCO0ORlNCN9N0MqIIn0b0iBiq7PaAewKrzwL80AnKq4hvrEl3xT1NC7XX9zelRaKQWkrrVtJgs4qBtI1C+GkHLwq+K2DSXdV8R2GieYQ1AOn0GxUxstsltko3rC63Pvg8Nm0e3Z+TOxF0EYCi5O4hgtrKewNOr11BPwILPeTPZJdk7vWoQ6H4W0cBU405+DCWMlfrBuQFGEKQ0259xj542ZHKTlOlFhbjBHh/apnD08IVE6eHwJiW29FYIbL6wgtJva//9uM/CKoy+LN3yvffnvbeb/mrn6vXgx72inuaRjjURdEml+JMWogKcL7lBSVjzRiN7sOLSo2UNLFCOPUhSDB3r2k1vLFxy8nTBaOqKm7asXBfpoANeRqUhdWkULIoRa+p+CEwzSwy3R51GXewJL8tnVu3gqgv4I74OfSCnkFeHvh9wfrQtppWasJ+GfFOjQBxUdooc55dHXvp8K8Hl3ZHp0f+LoB68J3Y=
install: 
    - sudo apt-get -y -q -m --no-install-suggests --no-install-recommends --allow-unauthenticated $(travis_apt_get_options) install dpkg mysql-server mysql-client 
before_install:
    #update packages in quite mode.
    - sudo apt-get -q update
    #install postfix mail server
    - sudo apt-get -y install postfix
    #create a test database
    - mysql -e 'create database if not exists testing_db;'
    - sudo mysql -e "use mysql; update user set authentication_string=PASSWORD('123456') where User='root'; update user set plugin='mysql_native_password';FLUSH PRIVILEGES;"
    - sudo mysql_upgrade -u root -p123456
    - sudo service mysql restart
before_script:
    - composer self-update
    - composer install --prefer-source --no-interaction
script:
    - phpunit --verbose --configuration phpunit.xml
after_success:
    - mysql -e 'drop database testing_db;'
    - bash <(curl -s https://codecov.io/bash)
    - sonar-scanner